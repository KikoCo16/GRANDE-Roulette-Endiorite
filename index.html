<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ðŸŽ¡ Roulette Endiorite</title>
<style>
*{box-sizing:border-box;}
body{margin:0;min-height:100vh;background:radial-gradient(circle at top,#0f172a,#020617);font-family:system-ui,Arial,sans-serif;color:#f0f9ff;display:flex;justify-content:center;align-items:center;padding:20px;}
.card{width:100%;max-width:500px;background:#0b1120;border-radius:16px;padding:24px;border:1px solid #1e3a8a;box-shadow:0 10px 40px rgba(0,0,0,0.8);}
h1{text-align:center;margin:12px 0;color:#60a5fa;font-size:1.8rem;}
.credit-box{text-align:center;font-size:24px;font-weight:bold;margin:15px 0;color:#3b82f6;text-shadow:0 0 10px rgba(59,130,246,0.4);}
input, select, button{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:none;font-size:16px;}
button{background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:#fff;font-weight:700;cursor:pointer;}
button:active{transform:scale(0.98);}
.msg{text-align:center;font-size:14px;min-height:20px;color:#7dd3fc;margin:10px 0;}
.result{font-size:32px;text-align:center;margin:15px 0;}
</style>
</head>
<body>
<div class="card">
<h1>ðŸŽ¡ Roulette</h1>
<div class="credit-box">ðŸ’° <span id="credits">0</span> crÃ©dits</div>

<!-- Type de pari -->
<select id="betType">
  <option value="number">NumÃ©ro (0-36)</option>
  <option value="color">Couleur</option>
  <option value="even">Pair/Impair</option>
</select>

<!-- Valeur du pari dynamique -->
<div id="betValueContainer">
  <input id="betValue" placeholder="Ex : 7">
</div>

<input id="betAmount" type="number" placeholder="Mise (max 200)">
<button id="spinBtn">Lancer la roulette</button>

<div class="result" id="resultDisplay">ðŸŽ² ?</div>
<div class="msg" id="resultMsg"></div>
<button id="backBtn">â¬… Retour</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDAQALLN99kqiYY4UZz9wl2stedP5KQ5mA",
  authDomain: "casino-b23c9.firebaseapp.com",
  databaseURL: "https://casino-b23c9-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "casino-b23c9",
  storageBucket: "casino-b23c9.appspot.com",
  messagingSenderId: "139229793155",
  appId: "1:139229793155:web:953b31b383a87bc3c504b6"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Utilisateur
const currentUser = localStorage.getItem("casinoUser");
if(!currentUser){ alert("Connectez-vous !"); window.location.href="https://kikoco16.github.io/Casino-Endiorite/"; }

// DOM
const creditsEl = document.getElementById("credits");
const betType = document.getElementById("betType");
const betValueContainer = document.getElementById("betValueContainer");
const betAmount = document.getElementById("betAmount");
const spinBtn = document.getElementById("spinBtn");
const resultDisplay = document.getElementById("resultDisplay");
const resultMsg = document.getElementById("resultMsg");
const backBtn = document.getElementById("backBtn");

const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
const blackNumbers = [2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35];

// Mise Ã  jour crÃ©dits
async function updateCredits(){
  const snap = await get(ref(db,"users/"+currentUser));
  creditsEl.textContent = snap.exists()?snap.val().credits:0;
}

// Fonction roulette
function spinRoulette(){
  const number = Math.floor(Math.random()*37);
  const color = number===0 ? 'vert' : (redNumbers.includes(number)?'rouge':'noir');
  return {number,color};
}

// VÃ©rification victoire
function checkWin(result, type, value){
  type=type.toLowerCase();
  value=value.toLowerCase();
  if(type==='number') return result.number==Number(value);
  if(type==='color') return result.color===value;
  if(type==='even') return result.number!==0 && ((value==='pair' && result.number%2===0) || (value==='impair' && result.number%2===1));
  return false;
}

// Changement dynamique de l'input selon le type
betType.onchange = ()=>{
  const type = betType.value;
  betValueContainer.innerHTML='';
  if(type==='number'){
    betValueContainer.innerHTML='<input id="betValue" placeholder="Ex : 7">';
  } else if(type==='color'){
    betValueContainer.innerHTML='<select id="betValue"><option value="rouge">Rouge</option><option value="noir">Noir</option></select>';
  } else if(type==='even'){
    betValueContainer.innerHTML='<select id="betValue"><option value="pair">Pair</option><option value="impair">Impair</option></select>';
  }
}

// Spin roulette
spinBtn.onclick = async()=>{
  let bet = parseInt(betAmount.value);
  if(!bet || bet <= 0){ resultMsg.textContent = "Mise invalide"; return; }
  if(bet > 200) bet = 200; // max 200

  const type = betType.value;
  const betValueEl = document.getElementById("betValue");
  const value = betValueEl.value.trim();
  if(!value){ resultMsg.textContent = "Valeur du pari manquante"; return; }

  const userRef = ref(db,"users/"+currentUser);
  const bankRef = ref(db,"users/Banque Centrale");

  const snap = await get(userRef);
  const bankSnap = await get(bankRef);
  if(!snap.exists()) return alert("Utilisateur inconnu");
  if(bet > snap.val().credits){ resultMsg.textContent = "Pas assez de crÃ©dits"; return; }

  const result = spinRoulette();
  resultDisplay.textContent = `${result.number} (${result.color})`;

  let multiplier = (type==='number') ? 10 : 1.5;
  const win = checkWin(result,type,value);

  if(win){
      // Gain â†’ joueur reÃ§oit
      const net = Math.floor(bet * (multiplier-1));
      await update(userRef,{
          credits: snap.val().credits + net,
          balance: (snap.val().balance || 0) + net,
          password: snap.val().password
      });
      resultMsg.textContent = `GagnÃ© ! x${multiplier} â†’ +${net} crÃ©dits`;
  } else {
      // Perte â†’ envoi dans Banque Centrale
      const bankCredits = bankSnap.exists() ? bankSnap.val().credits : 0;
      const bankBalance = bankSnap.exists() ? (bankSnap.val().balance || 0) : 0;

      await update(userRef,{ credits: snap.val().credits - bet });
      await update(bankRef,{
          credits: bankCredits + bet,
          balance: bankBalance + bet
      });

      resultMsg.textContent = `Perdu ðŸ˜¢ â†’ -${bet} crÃ©dits`;
  }

  updateCredits();
}

backBtn.onclick = ()=>window.location.href="https://kikoco16.github.io/Casino-Endiorite/";

updateCredits();
</script>
</body>
</html>
